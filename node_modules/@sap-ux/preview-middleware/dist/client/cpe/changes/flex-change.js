"use strict";

sap.ui.define(["sap/ui/rta/command/CommandFactory", "./validator"], function (CommandFactory, ___validator) {
  "use strict";

  const validateBindingModel = ___validator["validateBindingModel"];
  /**
   * Function to check a give value is a binding expression.
   *
   * @param value value to be checked.
   * @returns boolean
   */
  function isBindingExpression(value) {
    return value.includes('{') && value.includes('}') && value.indexOf('{') < value.indexOf('}');
  }

  /**
   *
   * @param options UI5 adaptation options
   * @param change changed property of a control
   */
  async function applyChange(options, change) {
    const {
      rta
    } = options;
    const modifiedControl = sap.ui.getCore().byId(change.controlId);
    if (!modifiedControl) {
      return;
    }
    const isBindingString = typeof change.value === 'string' && isBindingExpression(change.value);
    const modifiedControlModifiedProperties = modifiedControl.getMetadata().getAllProperties()[change.propertyName];
    const isBindingModel = isBindingString && modifiedControlModifiedProperties?.type === 'string';
    const flexSettings = rta.getFlexSettings();
    const changeType = isBindingString ? 'BindProperty' : 'Property';
    if (isBindingModel) {
      validateBindingModel(change.value);
    }
    const property = isBindingString ? 'newBinding' : 'newValue';
    const modifiedValue = {
      generator: flexSettings.generator,
      propertyName: change.propertyName,
      [property]: change.value
    };
    const command = await CommandFactory.getCommandFor(modifiedControl, changeType, modifiedValue, null, flexSettings);
    await rta.getCommandStack().pushAndExecute(command);
  }
  var __exports = {
    __esModule: true
  };
  __exports.applyChange = applyChange;
  return __exports;
});
//# sourceMappingURL=flex-change.js.map